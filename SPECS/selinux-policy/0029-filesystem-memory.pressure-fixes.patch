From b367a0054d591b688ad199f8ba6c36d088ca17c2 Mon Sep 17 00:00:00 2001
From: Chris PeBenito <chpebeni@linux.microsoft.com>
Date: Mon, 29 Apr 2024 16:36:38 -0400
Subject: [PATCH 29/29] filesystem: memory.pressure fixes.

Signed-off-by: Chris PeBenito <chpebeni@linux.microsoft.com>
---
 policy/modules/kernel/filesystem.fc | 2 ++
 policy/modules/kernel/filesystem.te | 1 +
 2 files changed, 3 insertions(+)

diff --git a/policy/modules/kernel/filesystem.fc b/policy/modules/kernel/filesystem.fc
index 8cdca1855..472b7b771 100644
--- a/policy/modules/kernel/filesystem.fc
+++ b/policy/modules/kernel/filesystem.fc
@@ -22,6 +22,8 @@
 
 /sys/kernel/tracing(/.*)?	<<none>>
 
+/sys/fs/cgroup/[^/]+\.slice/[^/]+\.service/memory\.pressure -- gen_context(system_u:object_r:memory_pressure_t,s0)
+
 ifdef(`distro_debian',`
 /run/shm		-d	gen_context(system_u:object_r:tmpfs_t,s0)
 /run/shm/.*			<<none>>
diff --git a/policy/modules/kernel/filesystem.te b/policy/modules/kernel/filesystem.te
index c5b6573f6..f9897903b 100644
--- a/policy/modules/kernel/filesystem.te
+++ b/policy/modules/kernel/filesystem.te
@@ -93,6 +93,7 @@ typeattribute cgroup_t cgroup_types;
 fs_type(cgroup_t)
 files_mountpoint(cgroup_t)
 dev_associate_sysfs(cgroup_t)
+allow cgroup_types cgroup_t:filesystem associate;
 genfscon cgroup / gen_context(system_u:object_r:cgroup_t,s0)
 genfscon cgroup2 / gen_context(system_u:object_r:cgroup_t,s0)
 # When running under systemd, the cgroup file memory.pressure will have this
-- 
2.44.0

